#!/bin/bash

# Purpose: checkout distro from lifemapper SVN and create *.tar.gz files to use in RPM. 
# NOTE: for svn checkout will be prompted for valid user/passwd.

SRC=@REPONAME@
URL=https://github.com/lifemapper/
TOPDIR=@REPONAME@-@VERSION@
SRCNAME=@NAME@

# download archive from lifemapper git
download_git () {
      echo "Starting GIT checkout from $URL"
      wget "$URL/$SRC/archive/refs/tags/@VERSION@.@TARBALL_POSTFIX@" 
      tar xzvf @VERSION@.@TARBALL_POSTFIX@
      
      if [ -d $TOPDIR ]; then
          echo "Removing .git in $TOPDIR:"
          DIRS=`find $TOPDIR -name .git`
          for i in $DIRS; do
              rm -rf $i
          done

      else
          echo "Error with GIT archive download from $URL/$SRC: directory $TOPDIR is not created"
      fi
}


# create distro files for lmcompute
create_distro () {
  if [ -d $TOPDIR ]; then
      # create lmtrex src distro
      echo "Creating lmtrex src archive from Github archive download"
      tar czf $SRCNAME-@VERSION@.@TARBALL_POSTFIX@ \
          $TOPDIR/src/lmtrex \
          $TOPDIR/tests \
          $TOPDIR/solrcores
  else
      echo "GIT downloaded directory $TOPDIR is not present"
  fi
}

### main ###
download_git
create_distro

TOPDIR=t-rex-0.1.2
tar czf lmtrex-0.1.2.tar.gz \
          $TOPDIR/src \
          $TOPDIR/tests \
          $TOPDIR/solrcores